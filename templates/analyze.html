<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EmotiSense - Facial Analysis</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <h1>EmotiSense</h1>
            </div>
            <div class="nav-links">
                <a href="/">Home</a>
                <a href="/analyze" class="active">Analyze</a>
                <a href="/about">About</a>
            </div>
        </div>
    </nav>

    <main class="container">
        <section class="hero">
            <h2>Video Facial Analysis</h2>
            <p>Upload a video to analyze age, gender, emotion, and race using DeepFace AI</p>
        </section>

        <section class="content">
            <div class="card upload-section">
                <h3>Upload Video</h3>
                <p>Select a video with visible faces for best results (max 100MB)</p>
                
                <div class="upload-area" id="uploadArea">
                    <svg class="upload-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                    </svg>
                    <p class="upload-text">Drag and drop a video here or click to select</p>
                    <input type="file" id="videoInput" accept="video/mp4,video/avi,video/mov,video/mkv,video/webm" hidden>
                    <button type="button" class="btn btn-primary" id="selectVideoBtn">Select Video</button>
                </div>

                <div id="videoPreview" class="video-preview" style="display: none;">
                    <video id="previewVideo" controls></video>
                    <div class="video-info" id="videoInfo"></div>
                    <button type="button" class="btn btn-secondary" id="analyzeBtn">Analyze Video</button>
                    <button type="button" class="btn btn-outline" id="clearBtn">Clear</button>
                </div>

                <div id="loadingIndicator" class="loading-indicator" style="display: none;">
                    <div class="spinner"></div>
                    <p>Analyzing video... This may take a minute depending on video length.</p>
                    <p class="loading-subtext">Processing frames and detecting faces...</p>
                </div>
            </div>

            <div class="card results-section" id="resultsSection" style="display: none;">
                <h3>Analysis Results</h3>
                
                <div class="video-stats" id="videoStats"></div>
                
                <div class="results-grid">
                    <div class="result-item">
                        <div class="result-icon">üë§</div>
                        <div class="result-content">
                            <h4>Average Age</h4>
                            <p class="result-value" id="ageResult">-</p>
                        </div>
                    </div>

                    <div class="result-item">
                        <div class="result-icon">‚öß</div>
                        <div class="result-content">
                            <h4>Dominant Gender</h4>
                            <p class="result-value" id="genderResult">-</p>
                            <div class="confidence-bars" id="genderConfidence"></div>
                        </div>
                    </div>

                    <div class="result-item">
                        <div class="result-icon">üòä</div>
                        <div class="result-content">
                            <h4>Dominant Emotion</h4>
                            <p class="result-value" id="emotionResult">-</p>
                            <div class="confidence-bars" id="emotionConfidence"></div>
                        </div>
                    </div>

                    <div class="result-item">
                        <div class="result-icon">üåç</div>
                        <div class="result-content">
                            <h4>Dominant Race</h4>
                            <p class="result-value" id="raceResult">-</p>
                            <div class="confidence-bars" id="raceConfidence"></div>
                        </div>
                    </div>
                </div>

                <div class="emotion-timeline" id="emotionTimeline" style="display: none;">
                    <h4>Emotion Distribution Throughout Video</h4>
                    <div id="emotionChart"></div>
                </div>

                <button type="button" class="btn btn-primary" id="analyzeAnotherBtn">Analyze Another Video</button>
            </div>

            <div class="card info-section">
                <h3>About This Analysis</h3>
                <p>This video facial analysis uses <a href="https://github.com/serengil/deepface" target="_blank" rel="noopener">DeepFace</a> with OpenCV to analyze faces throughout the video.</p>
                
                <h4>How it works:</h4>
                <ul>
                    <li><strong>Frame Extraction:</strong> Samples frames from your video (approximately 1 per second)</li>
                    <li><strong>Face Detection:</strong> Detects faces in each sampled frame</li>
                    <li><strong>Aggregation:</strong> Combines results across all frames for overall analysis</li>
                </ul>
                
                <h4>What it detects:</h4>
                <ul>
                    <li><strong>Average Age:</strong> Mean age across all analyzed frames</li>
                    <li><strong>Dominant Gender:</strong> Most common gender detected with confidence levels</li>
                    <li><strong>Dominant Emotion:</strong> Most frequent emotion (happy, sad, angry, surprise, fear, disgust, neutral)</li>
                    <li><strong>Dominant Race:</strong> Most common ethnicity (Asian, White, Middle Eastern, Indian, Latino, Black)</li>
                    <li><strong>Emotion Distribution:</strong> How emotions change throughout the video</li>
                </ul>

                <div class="info-note">
                    <strong>Tips:</strong> 
                    <ul>
                        <li>Use videos with clear, visible faces</li>
                        <li>Good lighting improves accuracy</li>
                        <li>Shorter videos (under 1 minute) process faster</li>
                        <li>Supported formats: MP4, AVI, MOV, MKV, WebM</li>
                        <li>Max file size: 100MB</li>
                    </ul>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 EmotiSense. Built with Flask & DeepFace.</p>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='js/analyze.js') }}"></script>
</body>
</html>

